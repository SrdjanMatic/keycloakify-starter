import{r as x,j as s}from"./index-DXUichdn.js";import{a as j,u as C,g as I,c as y,k as O}from"./KcPage-DTvYue0j.js";import{u as B}from"./useIsPasswordRevealed-Pcc4MubB.js";import{w as N}from"./waitForElementMountedOnDom-qpCjLZnq.js";j();j();function v(c){const{webAuthnButtonId:t,kcContext:a,i18n:n}=c,{url:d,isUserIdentified:i,challenge:e,userVerification:l,rpId:u,createTimeout:r}=a,{msgStr:p,isFetchingTranslations:o}=n,{insertScriptTags:m}=C({componentOrHookName:"LoginPassword",scriptTags:[{type:"module",textContent:()=>`

                    import { authenticateByWebAuthn } from "${d.resourcesPath}/js/webauthnAuthenticate.js";
                    const authButton = document.getElementById('${t}');
                    authButton.addEventListener("click", function() {
                        const input = {
                            isUserIdentified : ${i},
                            challenge : '${e}',
                            userVerification : '${l}',
                            rpId : '${u}',
                            createTimeout : ${r},
                            errmsg : ${JSON.stringify(p("webauthn-unsupported-browser-text"))}
                        };
                        authenticateByWebAuthn(input);
                    });
                `}]});x.useEffect(()=>{o||(async()=>(await N({elementId:t}),m()))()},[o])}function D(c){const{kcContext:t,i18n:a,doUseDefaultCss:n,Template:d,classes:i}=c,{kcClsx:e}=I({doUseDefaultCss:n,classes:i}),{realm:l,url:u,messagesPerField:r,enableWebAuthnConditionalUI:p,authenticators:o}=t,{msg:m,msgStr:h}=a,[b,k]=x.useState(!1),g="authenticateWebAuthnButton";return v({webAuthnButtonId:g,kcContext:t,i18n:a}),s.jsxs(d,Object.assign({kcContext:t,i18n:a,doUseDefaultCss:n,classes:i,headerNode:m("doLogIn"),displayMessage:!r.existsError("password")},{children:[s.jsx("div",Object.assign({id:"kc-form"},{children:s.jsx("div",Object.assign({id:"kc-form-wrapper"},{children:s.jsxs("form",Object.assign({id:"kc-form-login",onSubmit:()=>(k(!0),!0),action:u.loginAction,method:"post"},{children:[s.jsxs("div",Object.assign({className:y(e("kcFormGroupClass"),"no-bottom-margin")},{children:[s.jsx("hr",{}),s.jsx("label",Object.assign({htmlFor:"password",className:e("kcLabelClass")},{children:m("password")})),s.jsx(F,Object.assign({kcClsx:e,i18n:a,passwordInputId:"password"},{children:s.jsx("input",{tabIndex:2,id:"password",className:e("kcInputClass"),name:"password",type:"password",autoFocus:!0,autoComplete:"on","aria-invalid":r.existsError("username","password")})})),r.existsError("password")&&s.jsx("span",{id:"input-error-password",className:e("kcInputErrorMessageClass"),"aria-live":"polite",dangerouslySetInnerHTML:{__html:O(r.get("password"))}})]})),s.jsxs("div",Object.assign({className:e("kcFormGroupClass","kcFormSettingClass")},{children:[s.jsx("div",{id:"kc-form-options"}),s.jsx("div",Object.assign({className:e("kcFormOptionsWrapperClass")},{children:l.resetPasswordAllowed&&s.jsx("span",{children:s.jsx("a",Object.assign({tabIndex:5,href:u.loginResetCredentialsUrl},{children:m("doForgotPassword")}))})}))]})),s.jsx("div",Object.assign({id:"kc-form-buttons",className:e("kcFormGroupClass")},{children:s.jsx("input",{tabIndex:4,className:e("kcButtonClass","kcButtonPrimaryClass","kcButtonBlockClass","kcButtonLargeClass"),name:"login",id:"kc-login",type:"submit",value:h("doLogIn"),disabled:b})}))]}))}))})),p&&s.jsxs(s.Fragment,{children:[s.jsxs("form",Object.assign({id:"webauth",action:u.loginAction,method:"post"},{children:[s.jsx("input",{type:"hidden",id:"clientDataJSON",name:"clientDataJSON"}),s.jsx("input",{type:"hidden",id:"authenticatorData",name:"authenticatorData"}),s.jsx("input",{type:"hidden",id:"signature",name:"signature"}),s.jsx("input",{type:"hidden",id:"credentialId",name:"credentialId"}),s.jsx("input",{type:"hidden",id:"userHandle",name:"userHandle"}),s.jsx("input",{type:"hidden",id:"error",name:"error"})]})),o!==void 0&&o.authenticators.length!==0&&s.jsx(s.Fragment,{children:s.jsx("form",Object.assign({id:"authn_select",className:e("kcFormClass")},{children:o.authenticators.map((w,f)=>s.jsx("input",{type:"hidden",name:"authn_use_chk",readOnly:!0,value:w.credentialId},f))}))}),s.jsx("br",{}),s.jsx("input",{id:g,type:"button",className:e("kcButtonClass","kcButtonDefaultClass","kcButtonBlockClass","kcButtonLargeClass"),value:h("passkey-doAuthenticate")})]})]}))}function F(c){const{kcClsx:t,i18n:a,passwordInputId:n,children:d}=c,{msgStr:i}=a,{isPasswordRevealed:e,toggleIsPasswordRevealed:l}=B({passwordInputId:n});return s.jsxs("div",Object.assign({className:t("kcInputGroup")},{children:[d,s.jsx("button",Object.assign({type:"button",className:t("kcFormPasswordVisibilityButtonClass"),"aria-label":i(e?"hidePassword":"showPassword"),"aria-controls":n,onClick:l},{children:s.jsx("i",{className:t(e?"kcFormPasswordVisibilityIconHide":"kcFormPasswordVisibilityIconShow"),"aria-hidden":!0})}))]}))}export{D as default};
